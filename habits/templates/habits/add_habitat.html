{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Habit</title>
    <link rel="stylesheet" href="{% static 'css/style_add_habitat.css'%}">
</head>
<body>
<div class="wrapper">
    <header class="container_1">
        <nav>
            <ul class="left-nav">
                <li><a href="{% url 'users:profile' %}">Profile</a></li>
                <li class="Habitat"><a href="#" class="active">Habitat</a></li>
                <li><a href="#">Diagrams</a></li>
            </ul>
            <span class="logo">HabitFlow</span>
            <ul class="right-nav">
                <li><a href="{% url 'main:settings'%}">Settings</a></li>
                <li><a href="{% url 'main:about'%}">About</a></li>
            </ul>
        </nav>
    </header>
</div>

<div class="container"> 
    <div class="card">
        <h1>Add New Habit</h1>
        <p>Please fill in the details to add a new habit.</p>
        
        <!-- Форма отправляется по адресу `habits:create_habit` методом POST -->
        <form action="{% url 'habits:create_habit' %}" method="post">
            {% csrf_token %}
            
            <!-- Name -->
            <label for="id_name" class="form-label">Name of habit</label>
            <input type="text" class="form-control" id="id_name"
                   value="{% if form.name.value %}{{ form.name.value }}{% endif %}"
                   name="name"
                   placeholder="Name of habit" required>
            {% if form.name.errors %}
              <div class="alert alert-danger alert-dismissible fade show">
                {{ form.name.errors }}
              </div>
            {% endif %}

            <!-- Description -->
            <label for="id_description" class="form-label">Describe habit</label>
            <input type="text" class="form-control" id="id_description"
                   value="{% if form.description.value %}{{ form.description.value }}{% endif %}"
                   name="description"
                   placeholder="Describe habit" required>
            {% if form.description.errors %}
              <div class="alert alert-danger alert-dismissible fade show">
                {{ form.description.errors }}
              </div>
            {% endif %}
            
            <!-- Category -->
            <label for="id_category" class="form-label">Category</label>
            <select class="form-control" id="id_category" name="category" required>
                <!-- Для "placeholder"-опции -->
                <option value="" disabled selected hidden>Category</option>
                <option value="good">Good</option>
                <option value="bad">Bad</option>
            </select>
            {% if form.category.errors %}
              <div class="alert alert-danger alert-dismissible fade show">
                {{ form.category.errors }}
              </div>
            {% endif %}
            
            
            
            <!-- Frequency -->
            <label for="id_frequency" class="form-label">Frequency of execution</label>
            <select class="form-control" id="id_frequency" name="frequency" required>
                <option value="" disabled selected hidden>Frequency of execution</option>
                <option value="daily">Daily</option>
                <option value="weekly">Weekly</option>
                <option value="biweekly">Every 2 Weeks</option>
                <option value="monthly">Monthly</option>
                <option value="semiannual">Every 6 Months</option>
                <option value="yearly">Yearly</option>
            </select>
            {% if form.frequency.errors %}
              <div class="alert alert-danger alert-dismissible fade show">
                {{ form.frequency.errors }}
              </div>
            {% endif %}
            
            <!-- End Date -->
            <label for="id_end_date" class="form-label">End Date</label>
            <input type="text" class="form-control" id="id_end_date"
                   value="{% if form.end_date.value %}{{ form.end_date.value }}{% endif %}"
                   name="end_date"
                   placeholder="End Date"
                   onfocus="(this.type='date')"
                   onblur="if(!this.value) this.type='text'"
                   required>
            {% if form.end_date.errors %}
              <div class="alert alert-danger alert-dismissible fade show">
                {{ form.end_date.errors }}
              </div>
            {% endif %}
            
            <!-- Кнопка добавления -->
            <button type="submit" class="add-button">Add</button>
        </form>
    </div>
    
    <!-- Картинка (если хотите её вывести рядом) -->
    <div class="image-section">
        <img src="{% static 'img/habitat_img.svg'%}" alt="Meditation Illustration">
    </div>
</div>

{% comment %} <script>
    function saveHabit() {
        let habitName = document.getElementById("habit-name").value.trim();
        let habitCategory = document.getElementById("habit-category").value;
        let habitDescription = document.getElementById("habit-description").value.trim();
        let habitFrequency = document.getElementById("habit-frequency").value;
        let habitEndDate = document.getElementById("habit-end-date").value;
        let startDate = new Date().toISOString().split("T")[0]; // Сегодняшняя дата

        const user = JSON.parse(localStorage.getItem("user"));
        if (!user) {
            alert("You need to register first!");
            window.location.href = "registration.html";
            return;
        }

        if (!habitName || !habitDescription || !habitEndDate) {
            alert("Please fill in all fields!");
            return;
        }

        let userHabits = JSON.parse(localStorage.getItem(`habits_${user.email}`)) || [];

        let newHabit = {
            name: habitName,
            category: habitCategory,
            description: habitDescription,
            frequency: habitFrequency,
            startDate: startDate,
            endDate: habitEndDate
        };

        userHabits.push(newHabit);
        localStorage.setItem(`habits_${user.email}`, JSON.stringify(userHabits));

        alert("Habit added successfully!");
        window.location.href = `habit_tracker.html?habit=${encodeURIComponent(habitName)}`; // Переход в трекер
    }
</script> {% endcomment %}


</body>
</html>
