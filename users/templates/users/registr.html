{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registration</title>
    <link rel="stylesheet" href="{% static 'css/styles_registr.css' %}">
</head>
<body>
<div class="container">
    <div class="card">
        <h1>Registration</h1>
        <p>Please fill in the details to create an account.</p>
        <form action="#" onsubmit="event.preventDefault(); handleRegistration();">
            <label for="first-name">First Name</label>
            <input type="text" id="first-name" placeholder="Enter your first name" required>

            <label for="last-name">Last Name</label>
            <input type="text" id="last-name" placeholder="Enter your last name" required>

            <label for="email">Email Address</label>
            <input type="email" id="email" placeholder="Enter your email" required>

            <label for="password">Password</label>
            <input type="password" id="password" placeholder="Enter your password" required>

            <label for="confirm-password">Confirm Password</label>
            <input type="password" id="confirm-password" placeholder="Confirm your password" required>

            <button type="submit" class="register-button">Register</button>
        </form>
        <a href="{% url 'users:login' %}" class="back-to-login">Back to Login</a>
    </div>
</div>
<script>
    function handleRegistration() {
        let firstName = document.getElementById("first-name").value.trim();
        let lastName = document.getElementById("last-name").value.trim();
        let email = document.getElementById("email").value.trim();
        let password = document.getElementById("password").value.trim();
        let confirmPassword = document.getElementById("confirm-password").value.trim();

        // Проверяем, заполнены ли все поля
        if (!firstName || !lastName || !email || !password || !confirmPassword) {
            alert("Please fill in all fields!");
            return;
        }

        // Проверяем, совпадают ли пароли
        if (password !== confirmPassword) {
            alert("Passwords do not match!");
            return;
        }

        // Проверяем, зарегистрирован ли пользователь уже
        if (localStorage.getItem(email)) {
            alert("User already exists! Please log in.");
            return;
        }

        // Сохраняем пользователя в localStorage
        localStorage.setItem(email, JSON.stringify({
            firstName: firstName,
            lastName: lastName,
            password: password
        }));

        alert("Registration successful! Please log in.");
        window.location.href = "registration.html"; // Переход на страницу входа
    }

    function login() {
        let email = document.getElementById("login-email").value.trim();
        let password = document.getElementById("login-password").value.trim();

        if (!email || !password) {
            alert("Please enter your email and password!");
            return;
        }

        let userData = localStorage.getItem(email);

        if (!userData) {
            document.getElementById("login-error").innerText = "User not found. Please register.";
            return;
        }

        let user = JSON.parse(userData);

        if (user.password === password) {
            alert(`Welcome, ${user.firstName} ${user.lastName}!`);
            localStorage.setItem("user", JSON.stringify(user)); // Сохраняем текущего пользователя
            window.location.href = "main_after_registration.html"; // Теперь после входа ведет на главную страницу!
        } else {
            document.getElementById("login-error").innerText = "Incorrect password!";
        }
    }

</script>
</body>
</html>
